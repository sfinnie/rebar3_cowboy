# Rebar3 Cowboy Plugin

A minimal set of [rebar3](https://www.rebar3.org) templates to aid creating [Cowboy](https://ninenines.eu/docs/en/cowboy/2.6/guide/)-based Erlang applications.

2 templates are provided: 

* `cowboy_app` for generating new Cowboy-based OTP Applications
* `cowboy_handler` for generating new Cowboy [handlers](https://ninenines.eu/docs/en/cowboy/2.6/guide/handlers/) for an existing application.

## Installation

Ensure [rebar3](https://www.rebar3.org) is installed and working.

Clone this repo to your `~/.config/rebar3/templates` directory:

	mkdir -p ~/.config/rebar3/templates
	git clone https://github.com/sfinnie/rebar3_cowboy.git

Running `rebar3 new` should now show 2 extra templates available:

	$ rebar3 new
	[...]
	cowboy_app (custom): Cowboy application using complete OTP Application structure.
	cowboy_handler (custom): Basic handler module for a Cowboy application
	[...]

## Use

### Creating a new application

	$ cd ~/projects # or wherever else you want to put your app
	$ rebar3 new cowboy_app app_name # change app_name for whatever you want to call your app
	$ cd app_name
	$ rebar3 compile
	$ rebar3 shell

Compiling the app will download dependencies which will then be started automatically in the shell:

	===> Booted cowlib
	===> Booted ranch
	===> Booted cowboy
	===> Booted app_name

The app should now be running. To check, open another terminal:

	$ curl localhost:8080
	Response body - replace me

"Response body - replace me" is the default response generated by the handler created with the application.  Edit the handler (`src/app_name_handler.erl`) as required.  See the [Cowboy docs](https://ninenines.eu/docs/en/cowboy/2.6/guide/) for building out the app from here.

### Adding a new handler

A separate template is provided for adding extra handlers to an existing application.  It should be called from the app directory and can be called as many times as required per app.

First, create the handler: 

	~/projects/app_name $ rebar3 new cowboy_handler second

This will generate a new source file named `src/second_handler.erl`

Then set up the desired routing for the new handler in the `_app.erl` file (e.g. `src/app_name_app.erl`): 

	start(_StartType, _StartArgs) ->
		Dispatch = cowboy_router:compile([
				{'_', [{"/", app_name_handler, []},
					{"/second", second_handler, []} % <-- new route
					]}
			]),
		{ok, _} = cowboy:start_clear(my_http_listener,
			[{port, 8080}],
			#{env => #{dispatch => Dispatch}}
			),

		app_name_sup:start_link().

Then compile and run the app as before:

	~/projects/app_name $ rebar3 compile
	~/projects/app_name $ rebar3 shell

To test (in aother terminal):

	$ curl localhost:8080/second
	Response body - replace me


